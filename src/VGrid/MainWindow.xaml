<Window x:Class="VGrid.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:VGrid"
        xmlns:converters="clr-namespace:VGrid.Converters"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" Height="700" Width="1200"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Window.Resources>
        <converters:ModeToColorConverter x:Key="ModeToColorConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Excel-like DataGrid Style -->
        <Style x:Key="ExcelDataGridStyle" TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="GridLinesVisibility" Value="All"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#D0D0D0"/>
            <Setter Property="VerticalGridLinesBrush" Value="#D0D0D0"/>
            <Setter Property="RowHeaderWidth" Value="40"/>
            <Setter Property="ColumnHeaderHeight" Value="25"/>
            <Setter Property="BorderBrush" Value="#BEBEBE"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- Excel-like Column Header Style -->
        <Style x:Key="ExcelColumnHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#F0F0F0"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderBrush" Value="#BEBEBE"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="Padding" Value="5,3"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="ColumnHeader_PreviewMouseLeftButtonDown"/>
            <EventSetter Event="MouseRightButtonUp" Handler="ColumnHeader_MouseRightButtonUp"/>
        </Style>

        <!-- Excel-like Row Header Style -->
        <Style x:Key="ExcelRowHeaderStyle" TargetType="DataGridRowHeader">
            <Setter Property="Background" Value="#F0F0F0"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderBrush" Value="#BEBEBE"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Width" Value="40"/>
            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="RowHeader_PreviewMouseLeftButtonDown"/>
            <EventSetter Event="MouseRightButtonUp" Handler="RowHeader_MouseRightButtonUp"/>
        </Style>

        <!-- Excel-like Cell Style -->
        <Style x:Key="ExcelCellStyle" TargetType="DataGridCell">
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#D4E7F7"/>
                    <Setter Property="Foreground" Value="Black"/>
                    <Setter Property="BorderBrush" Value="#4A90E2"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_New" Command="{Binding NewFileCommand}" InputGestureText="Ctrl+N"/>
                <MenuItem Header="_Open File..." Command="{Binding OpenFileCommand}" InputGestureText="Ctrl+O"/>
                <MenuItem Header="Open _Folder..." Command="{Binding OpenFolderCommand}" InputGestureText="Ctrl+K Ctrl+O"/>
                <Separator/>
                <MenuItem Header="_Save" Command="{Binding SaveFileCommand}" InputGestureText="Ctrl+S"/>
                <MenuItem Header="Save _As..." Command="{Binding SaveAsFileCommand}"/>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Enable _Vim Mode"
                          IsCheckable="True"
                          IsChecked="{Binding IsVimModeEnabled, Mode=TwoWay}"/>
            </MenuItem>
        </Menu>

        <!-- Status Bar -->
        <StatusBar DockPanel.Dock="Bottom" Height="30">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <Border Background="{Binding StatusBarViewModel.ModeBrush}"
                            CornerRadius="3" Padding="8,2" Margin="0,0,10,0">
                        <TextBlock Text="{Binding StatusBarViewModel.ModeText}"
                                   Foreground="White" FontWeight="Bold"/>
                    </Border>
                    <TextBlock Text="{Binding StatusBarViewModel.PositionText}"
                               Margin="10,0" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding StatusBarViewModel.MessageText}"
                               Margin="20,0" VerticalAlignment="Center" FontStyle="Italic"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>

        <!-- Main Content Area with Splitter -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250" MinWidth="150"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Folder Explorer (Left Panel) -->
            <Border Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="0,0,1,0" Background="#F5F5F5">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="EXPLORER" FontWeight="Bold"
                               Padding="10,8" Background="#E8E8E8" Foreground="#333"/>
                    <TreeView x:Name="FolderTreeView" BorderThickness="0" Background="#F5F5F5"
                              Margin="0" Padding="5" KeyDown="FolderTreeView_KeyDown">
                        <!-- Tree items will be populated in code-behind -->
                    </TreeView>
                </DockPanel>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

            <!-- Tab Control (Right Panel) -->
            <TabControl Grid.Column="2"
                        ItemsSource="{Binding Tabs}"
                        SelectedItem="{Binding SelectedTab}"
                        Margin="0" BorderThickness="0"
                        SelectionChanged="TabControl_SelectionChanged">
                <TabControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Header}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <Button Content="Ã—" FontSize="14" FontWeight="Bold"
                                    Width="18" Height="18"
                                    Command="{Binding DataContext.CloseTabCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                    CommandParameter="{Binding}"
                                    Background="Transparent" BorderThickness="0"
                                    Cursor="Hand" ToolTip="Close"/>
                        </StackPanel>
                    </DataTemplate>
                </TabControl.ItemTemplate>
                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <Border BorderBrush="Gray" BorderThickness="0" Margin="0">
                            <DataGrid x:Name="TsvGrid"
                                      ItemsSource="{Binding GridViewModel.Rows}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      CanUserDeleteRows="False"
                                      CanUserReorderColumns="False"
                                      CanUserSortColumns="False"
                                      IsReadOnly="False"
                                      SelectionMode="Extended"
                                      SelectionUnit="Cell"
                                      DataContextChanged="TsvGrid_OnDataContextChanged"
                                      BeginningEdit="TsvGrid_BeginningEdit"
                                      HeadersVisibility="All"
                                      Focusable="False"
                                      EnableRowVirtualization="True"
                                      EnableColumnVirtualization="True"
                                      VirtualizingPanel.IsVirtualizing="True"
                                      VirtualizingPanel.VirtualizationMode="Recycling"
                                      Style="{StaticResource ExcelDataGridStyle}"
                                      ColumnHeaderStyle="{StaticResource ExcelColumnHeaderStyle}"
                                      RowHeaderStyle="{StaticResource ExcelRowHeaderStyle}"
                                      CellStyle="{StaticResource ExcelCellStyle}"
                                      Loaded="TsvGrid_Loaded"
                                      Margin="0">
                                <!-- Columns will be generated dynamically in code-behind -->
                            </DataGrid>
                        </Border>
                    </DataTemplate>
                </TabControl.ContentTemplate>
            </TabControl>
        </Grid>
    </DockPanel>
</Window>
