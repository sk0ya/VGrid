<Window x:Class="VGrid.Views.GitBranchWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:VGrid.Converters"
        mc:Ignorable="d"
        Title="Git Branches"
        Height="500" Width="700"
        Background="{DynamicResource WindowBackgroundBrush}"
        WindowStyle="None"
        AllowsTransparency="False"
        WindowStartupLocation="CenterOwner">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      ResizeBorderThickness="5"
                      GlassFrameThickness="0"
                      CornerRadius="0"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:StringEqualityConverter x:Key="StringEqualityConverter"/>
        <!-- ListBox Item Style -->
        <Style x:Key="BranchListBoxItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource ListBoxForegroundBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource SidebarItemHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource SidebarItemSelectedBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Button Style -->
        <Style x:Key="GitButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource ButtonForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ButtonBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="30"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Grid Grid.Row="0" Background="{DynamicResource TitleBarBackgroundBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="Git Branches" FontSize="12"
                       Foreground="{DynamicResource TitleBarForegroundBrush}"
                       VerticalAlignment="Center" Margin="12,0,0,0"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal" WindowChrome.IsHitTestVisibleInChrome="True">
                <Button x:Name="CloseButton" Click="CloseButton_Click"
                        Width="46" Height="32" BorderThickness="0"
                        Background="Transparent"
                        Foreground="{DynamicResource TitleBarForegroundBrush}"
                        ToolTip="Close">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" Background="{TemplateBinding Background}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#E81123"/>
                                                <Setter Property="Foreground" Value="White"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <Path Data="M0,0 L10,10 M10,0 L0,10"
                          Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                          StrokeThickness="1" Width="10" Height="10"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Action Toolbar -->
        <Border Grid.Row="1" Background="{DynamicResource SidebarBackgroundBrush}"
                BorderBrush="{DynamicResource SidebarBorderBrush}" BorderThickness="0,0,0,1"
                Padding="8">
            <StackPanel Orientation="Horizontal">
                <!-- Current Branch Display -->
                <Border Background="{DynamicResource ButtonBackgroundBrush}"
                        BorderBrush="{DynamicResource ButtonBorderBrush}"
                        BorderThickness="1" CornerRadius="3"
                        Padding="10,5" Margin="0,0,10,0">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M11,17.5A2.5,2.5 0 0,1 8.5,15A2.5,2.5 0 0,1 11,12.5A2.5,2.5 0 0,1 13.5,15A2.5,2.5 0 0,1 11,17.5M11,9.5A2.5,2.5 0 0,1 8.5,7A2.5,2.5 0 0,1 11,4.5A2.5,2.5 0 0,1 13.5,7A2.5,2.5 0 0,1 11,9.5M11,2A5,5 0 0,0 6,7C6,8.39 6.5,9.68 7.34,10.66L7.34,10.66L8,11.37V17A2,2 0 0,0 10,19H12A2,2 0 0,0 14,17V11.37L14.66,10.66C15.5,9.68 16,8.39 16,7A5,5 0 0,0 11,2Z"
                              Fill="{DynamicResource ButtonForegroundBrush}"
                              Width="16" Height="16" Stretch="Uniform" Margin="0,0,6,0"/>
                        <TextBlock Text="{Binding CurrentBranchDisplay}"
                                   Foreground="{DynamicResource ButtonForegroundBrush}"
                                   FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding TrackingStatusDisplay}"
                                   Foreground="{DynamicResource ButtonForegroundBrush}"
                                   Margin="8,0,0,0" VerticalAlignment="Center"
                                   Opacity="0.8"/>
                    </StackPanel>
                </Border>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="5,0"/>

                <!-- Action Buttons -->
                <Button Content="Fetch" Command="{Binding FetchCommand}"
                        Style="{StaticResource GitButtonStyle}" ToolTip="Fetch all remotes"/>
                <Button Content="Pull" Command="{Binding PullCommand}"
                        Style="{StaticResource GitButtonStyle}" ToolTip="Pull from remote"/>
                <Button Content="Push" Command="{Binding PushCommand}"
                        Style="{StaticResource GitButtonStyle}" ToolTip="Push to remote"/>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="5,0"/>

                <Button Content="+ New Branch" Command="{Binding CreateBranchCommand}"
                        Style="{StaticResource GitButtonStyle}" ToolTip="Create a new branch"/>
                <Button Content="Refresh" Command="{Binding RefreshCommand}"
                        Style="{StaticResource GitButtonStyle}" ToolTip="Refresh branch list"/>
            </StackPanel>
        </Border>

        <!-- Branch Lists -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Local Branches -->
            <DockPanel Grid.Column="0" Background="{DynamicResource SidebarBackgroundBrush}">
                <Border DockPanel.Dock="Top" Padding="10,8"
                        Background="{DynamicResource SidebarHeaderBackgroundBrush}"
                        BorderBrush="{DynamicResource SidebarBorderBrush}" BorderThickness="0,0,0,1">
                    <TextBlock Text="LOCAL BRANCHES" FontSize="11" FontWeight="SemiBold"
                               Foreground="{DynamicResource SidebarHeaderForegroundBrush}"/>
                </Border>

                <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Margin="8">
                    <Button Content="Checkout" Command="{Binding CheckoutCommand}"
                            Style="{StaticResource GitButtonStyle}"
                            ToolTip="Switch to selected branch"/>
                    <Button Content="Delete" Command="{Binding DeleteBranchCommand}"
                            Style="{StaticResource GitButtonStyle}"
                            ToolTip="Delete selected branch"/>
                </StackPanel>

                <ListBox ItemsSource="{Binding LocalBranches}"
                         SelectedItem="{Binding SelectedLocalBranch}"
                         Background="{DynamicResource ListBoxBackgroundBrush}"
                         BorderThickness="0"
                         ItemContainerStyle="{StaticResource BranchListBoxItemStyle}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M11,17.5A2.5,2.5 0 0,1 8.5,15A2.5,2.5 0 0,1 11,12.5A2.5,2.5 0 0,1 13.5,15A2.5,2.5 0 0,1 11,17.5M11,9.5A2.5,2.5 0 0,1 8.5,7A2.5,2.5 0 0,1 11,4.5A2.5,2.5 0 0,1 13.5,7A2.5,2.5 0 0,1 11,9.5M11,2A5,5 0 0,0 6,7C6,8.39 6.5,9.68 7.34,10.66L7.34,10.66L8,11.37V17A2,2 0 0,0 10,19H12A2,2 0 0,0 14,17V11.37L14.66,10.66C15.5,9.68 16,8.39 16,7A5,5 0 0,0 11,2Z"
                                      Fill="{DynamicResource ListBoxForegroundBrush}"
                                      Width="14" Height="14" Stretch="Uniform" Margin="0,0,8,0"
                                      Opacity="0.7"/>
                                <TextBlock Text="{Binding}"
                                           Foreground="{DynamicResource ListBoxForegroundBrush}"/>
                                <TextBlock Text="(current)" Margin="8,0,0,0"
                                           Foreground="{DynamicResource ListBoxForegroundBrush}"
                                           FontStyle="Italic" Opacity="0.7">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Value="True">
                                                    <DataTrigger.Binding>
                                                        <MultiBinding>
                                                            <MultiBinding.Converter>
                                                                <converters:StringEqualityConverter/>
                                                            </MultiBinding.Converter>
                                                            <Binding/>
                                                            <Binding Path="DataContext.CurrentBranch" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                        </MultiBinding>
                                                    </DataTrigger.Binding>
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch"
                          Background="{DynamicResource SplitterBackgroundBrush}"/>

            <!-- Remote Branches -->
            <DockPanel Grid.Column="2" Background="{DynamicResource SidebarBackgroundBrush}">
                <Border DockPanel.Dock="Top" Padding="10,8"
                        Background="{DynamicResource SidebarHeaderBackgroundBrush}"
                        BorderBrush="{DynamicResource SidebarBorderBrush}" BorderThickness="0,0,0,1">
                    <TextBlock Text="REMOTE BRANCHES" FontSize="11" FontWeight="SemiBold"
                               Foreground="{DynamicResource SidebarHeaderForegroundBrush}"/>
                </Border>

                <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Margin="8">
                    <Button Content="Checkout" Command="{Binding CheckoutRemoteCommand}"
                            Style="{StaticResource GitButtonStyle}"
                            ToolTip="Create local branch and switch to it"/>
                </StackPanel>

                <ListBox ItemsSource="{Binding RemoteBranches}"
                         SelectedItem="{Binding SelectedRemoteBranch}"
                         Background="{DynamicResource ListBoxBackgroundBrush}"
                         BorderThickness="0"
                         ItemContainerStyle="{StaticResource BranchListBoxItemStyle}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"
                                      Fill="{DynamicResource ListBoxForegroundBrush}"
                                      Width="14" Height="14" Stretch="Uniform" Margin="0,0,8,0"
                                      Opacity="0.7"/>
                                <TextBlock Text="{Binding}"
                                           Foreground="{DynamicResource ListBoxForegroundBrush}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Grid>

        <!-- Loading Indicator -->
        <Border Grid.Row="3" Padding="8"
                Background="{DynamicResource SidebarBackgroundBrush}"
                BorderBrush="{DynamicResource SidebarBorderBrush}" BorderThickness="0,1,0,0"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="Loading..." Foreground="{DynamicResource SidebarForegroundBrush}"/>
            </StackPanel>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="4" Background="{DynamicResource StatusBarBackgroundBrush}">
            <TextBlock Text="{Binding StatusMessage}"
                       Foreground="{DynamicResource StatusBarForegroundBrush}"
                       VerticalAlignment="Center" Margin="10,0"/>
        </Border>
    </Grid>
</Window>
